<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.mycompany.webapp.place.dao.PlaceDao">

	<select id="count" parameterType="String" resultType="int">  <!-- 관광지 총 개수 (중복없이)-->
		select count(distinct place_name)
		from place
		where category=#{category}
	</select>
	

	
	
	<select id="selectPlaceList" parameterType="map" resultType="place">  <!-- 중복 관광지 제외 페이징 처리할 관광지 리스트 -->
		select rnum, place_name as placeName , area_name as areaName , detail_cd_name as category
		from (
			select ROWNUM as rnum, place_name  , area_name  , detail_cd_name
			from(
				SELECT  p.place_name as place_name,p.area_name as area_name,d.detail_cd_name as detail_cd_name

				FROM(
    					SELECT ROW_NUMBER() OVER(PARTITION BY place.place_name ORDER BY place.area_name ) AS RNUM, place.*
    					FROM place where category=#{category} ) p,detail_code d
                        

				WHERE RNUM = 1 and d.detail_cd_id=p.category
				
			)
			where rownum &lt;=#{endRowNo}
		)
		where rnum &gt;=#{startRowNo}
	</select>  
	
	<select id="KeywordPlaceSearch" parameterType="map"  resultType="place">
	
		select rnum, place_name as placeName , area_name as areaName , detail_cd_name as category
		from (
			select ROWNUM as rnum, place_name  , area_name  , detail_cd_name
			from(
				select p.place_name,p.area_name,d.detail_cd_name
				from ( select place_name,area_name,category,row_number() over(partition by place_name order by area_name desc)as rn
        				from place)p, detail_code d
				<trim prefix="where" prefixOverrides="AND|OR">
				<if test="keyword != null and keyword !='' ">
					<if test="key=='p.area_name'">
						AND rn=1 and p.area_name like '%'||#{keyword}||'%' and p.category=d.detail_cd_id
					</if>
					<if test="key=='p.place_name'">
						AND rn=1 and p.place_name like '%'||#{keyword}||'%' and p.category=d.detail_cd_id
					</if>
				</if>
			</trim>

				
			)
			where rownum &lt;=#{endRowNo}
		)
		where rnum &gt;=#{startRowNo}
	
	</select>
	
	<select id="countKeyword" parameterType="map" resultType="int">
		
			select count(*)
			from (select place_name,area_name,category,row_number() over(partition by place_name order by area_name desc)as rn from place)p, detail_code d
			<trim prefix="where" prefixOverrides="AND|OR">
				<if test="keyword != null and keyword !='' ">
					<if test="key=='p.area_name'">
						AND rn=1 and p.area_name like '%'||#{keyword}||'%' and p.category=d.detail_cd_id
					</if>
					<if test="key=='p.place_name'">
						AND rn=1 and p.place_name like '%'||#{keyword}||'%' and p.category=d.detail_cd_id
					</if>
				</if>
			</trim>
		
	</select>
	
	
	
</mapper>